# 무중단 배포(Zero-Downtime Deployment) 란?

무중단 배포란 서비스가 중단되지 않은 상태로 새로운 버전을 배포하는 배포방식이다.  
서비스가 운영되는 상태에 새로운 버전을 배포할 때 다운타임이 생기지 않아 UX를 개선할 수 있다.

> 다운타임 (Down Time)
> 서버나 웹 등의 시스템이나 서비스를 사용할 수 없는 기간

### 무중단 배포를 사용하지 않으면 
만약 무중단 배포방식을 사용하지 않을 시 새로운 버전을 배포하는 동안 서비스가 일시적으로 중단되어 다운타임이 
발생할 수 있다.  
이로인해서 요청오류로 인한 UX저하나 비즈니스적 손실 등이 발생할 수 있다.  

위 단점들을 사전에 예방하고자 무중단 배포방식을 사용해야 한다.  
무중단 배포에도 전략이 여러가지가 있다.  
그럼 무중단 배포전략에는 어떤 것들이 있을까?  

1. Blue / Green 배포
2. Rolling 배포
3. Canary 배포

## Blue/Green 배포
- Blue: 구버전
- Green: 신버전

운영중인 구버전과 동일하게 신버전의 인스턴스를 구성한 후 로드밸런서를 통해  
모든 트래픽을 한번에 신버전 쪽으로 전환하는 방식이다.  
이전 버전과 새로운 버전의 서버를 공통 로드 밸랜서 하에 동시에 운영하기 위해  
두 개의 독립적인 환경 또는 인스턴스를 이용하는 것이 핵심이다.

새로운 버전의 배포준비를 위해 하나의
#### 장점
- 구버전의 인스턴스가 있어 문제가 발생시 빠르게 롤백이 가능하다
#### 단점
운영에 필요한 서버 인스턴스를 2배를 확보해야 한다.

그럼 이 단점을 보완할 수는 없을까?

2개 이상의 인스턴스 상에서 로드밸런싱으로 트래픽을 한쪽으로 처리한 후  
비어있는 인스턴스를 신버전으로 배포한 후 다시 트래픽을 신버전으로 바꾼 인스턴스로 처리하고  
나머지 인스턴스도 신버전으로 교체후 점진적으로 유연하게 신버전으로 교체하는 방식이라면 어떨까?  
이 방식의 경우 기존 Blue/ Green 배포의 단점이었던 인스턴스를 2배로 운영해야 하는 리소스 낭비 문제를 해결할 수 있다.  
이 방식이 바로 Rolling 배포 방식이다.  

## Rolling 배포
서비스 중인 인스턴스 하나를 로드 밸런서에서 라우팅하지 않도록 떼어낸다. (이렇게 되면 해당 서버에는 트래픽이 도달하지 않게 된다.)  
이 상태에서 해당 서버의 애플리케이션을 새 버전으로 교체한다.  
이 과정을 모든 서버가 새로운 버전으로 교체되도록 돌아가면서 반복한다.  

#### 장점
- 제한적인 인스턴스나 서버의 상태에서 배포가 가능하다.
#### 단점
- 새 버전으로 배포시 인스턴 수가 줄어들게 되어 서버가 부담하는 트래픽의 양이 기존대비 증가한다.

## Canary 배포
왜 이름이 Canary일까?  
옛날 광부들이 유독가스로 인해 문제가 되는 경우가 종종 발생하였는데 이때 광부들은 유독 가스에 민감한 카나리아  
새를 이용해 가스 누출 위험을 조기에 감지하였다.  
이때 새의 이름을 따서 카나리 배포라고 이름을 정의하였다.  
Canary 배포는 잠재적 문제 상황을 미리 발견하기 위한 방식이다.  
신버전을 소수의 유저들에게만 배포를 해보고 문제가 없는것을 확인해가며 점차 많은 유저들에게 배포하는 기법이다.  
블루그린 배포와 유사하지만 블루그린처럼 트래픽을 한번에 확 바꾸는 것이 아니라 단계적으로 전환하기에 부정적 영향을 최소화하고 상황에 따라 트래픽 양을 조절하며 롤백할 수 있다.  

#### 장점
- 문제 상황을 빠르게 감지할 수 있다.

#### 단점
- 트래픽 제어 부담의 위험이 있다.
