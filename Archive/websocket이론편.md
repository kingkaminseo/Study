# 🔌 Web Socket은 뭐야, 아니 그전에 Socket이 뭐야? <br/> ㅤ  ( 웹소캣 이론 편 )

회사 업무중 웹소캣을 사용하여 업무를 처리해야하는 이슈가 있었다. <br/>
개발을 하다보면 웹소캣을 모르더라도 한번은 들어보았을 것이고 나도 그런케이스였다.<br/>
들어만 보고 어렵다는 소문에 피하고 무시하면서 살아왔지만 언제까지 피할 순 없기에<br/>
악명높은 웹소캣.. 오늘은 그에 대해 공부해보려고 한다.<br/>

#### 핵심: WebSocket은 웹 앱과 서버 간의 지속적인 연결을 제공하는 프로토콜입니다.
웹소캣과 소캣은 비슷해 보이지만 분명한 차이가 있고 우리는 WebSocket에 대해 공부하기 전에, Socket이 뭔지부터 배워보자

## Socket Programming
네트워크를 통해 데이터 송수신을 가능하게 하는 기술을 `Socket Programming` 라고 한다.<br/>
기존 Http 프로토콜 통신은 클라이언트만 요청을 보낼 수 있고 서버만 요청에 따른 응답을 내려줄 있다.<br/>
이 말을 쉽게 말하면, 서버에서 어떤 이벤트가 발생하여 클라이언트에게 데이터를 내려주고 싶을 때 내려줄 수 없다는 말이다.<br/>
하지만 Socket은 이를 보완하여 `양방향 통신`이 가능하도록 했다.<br/>
이러한 Socket은 서버에서도 클라이언트에게 요청을 보낼 수 있게 `Server Socket`, `Socket Client`을 사용하여 관리하고 있다.<br/>
통신 연결 요청을 받아들이는 Socket을 Server Socket, 통신 연결 요청을 보내는 Socket을 Client Socket 이라고 한다.<br/>

그러면 이들이 각각 하는 역할과 처리되는 흐름에 대해 알아보자.

### Client Socket의 처리 흐름 (컴퓨터)   
1. #### Client Socket 생성
   - 연결 대상에 대한 정보가 들어있지 않은 껍데기 Socket을 생성한다.
  
2. #### 연결 요청(Connection)
    - Socket Server의 IP 주소와 Port 번호로 연결하고 싶은 대상을 특정하여 Connection 요청을 보내고 그에 대한 Response를 받는다.
    - 연결에 대한 응답을 받으면 실행이 끝난다.
    - 
3. #### 데이터의 송수신 (Send, Recieve)
    - 데이터 송수신에 대한 응답을 받으면 실행이 끝난다..

    - 송수신 간의 차이점.

        - 송신(Send)할 때에는 데이터를 보내는 것이기 때문에 데이터를 언제, 얼마나 보낼 것인지를 알 수 있다.

        - 수신(Recieve)할 때에는 상대방이 언제, 얼만큼의 데이터를 보낼 것인지 알 수가 없다.
        - 그렇기 때문에 수신하는 API는 별도의 Thread에서 진행하게 된다.
     
4. Socket 닫기 (Disconnection)
    - 더 이상의 데이터 송수신이 필요없어지게되면, 소켓을 닫는다.
  

---
## Server Socket에서 Port란?
먼저 Server Socket을 배우기 전에 Socket과 Port에 대해 알아보도록 하자.<br/>
데이터를 송수신 함에 있어 보안이 중요하다고 함<br/>
데이터를 송신하면 이상한 곳에서 수신 받는게 아니라 내가 원하는 곳에 잘 가야됌.<br/>
데이터를 받는 입장에서 무작정 데이터를 수신하는 것이 아니라, <br/>
데이터를 받을 호스트의 프로세스 레벨에서 어떤 프로세스가 이 데이터를 받아야하는 지 판단하고나서 데이터를 수신한다. <br/>
<br/>
※ 호스트 - 네트워크 주소(IP 주소)가 할당된 Node<br/>
※ Node - 네트워크에 연결된 모든 종류의 장치<br/>
<br/>
해당 프로세스가 특정 프로세스인지는 Port로 식별한다.<br/>
※ Port란 네트워크를 통해 데이터를 주고받을 때, 프로세스를 식별하기 위해 호스트 내부적으로 프로세스가 할당받는 고유한 값이다.<br/>
1. 데이터를 보낼 때, 데이터의 목적지에 Port를 입력해 전달한다.<br/>
2. 그렇게 데이터가 도착하면, 목적지에 적힌 Port 번호를 가지고있는 프로세스를 찾아 데이터를 전달한다.<br/>

각 프로세스에서 사용하는 Socket은 데이터를 송수신하기 위한 Port 번호를 사용하게 된다.<br/>
(이 Port 번호는 프로토콜 표준에 따라 시스템이 관리하는 포트 중 하나의 포트번호를 사용하게 된다.)<br/>
2개 이상이 프로세스의 포트번호가 Socket이 사용하는 Port 번호가 같게된다면 어떻게 될까?<br/>
데이터가 도착했는데 어느 프로세스로 데이터를 보내줘야 할 지 혼란이 오게 될 것이다.<br/>

또한 하나의 프로세스는 같은 Port를 가진 Socket을 여러개 열 수 있다.

호스트 A가 하나의 Port로 여러 개의 Socket을 만들어 다른 호스트들과 데이터를 주고받을 수 있다.<br/>
이러한 이유 덕분에 우리가 하나의 채팅 앱을 사용하더라도 동시에 많은 사람들과 채팅을 주고받을 수 있는 것이라고 생각한다.<br/>
'그루밍'이라는 Port가 Socket을 여러개 열어서 Socket1로는 피터, Socket2로는 포츈, Socket3으로는 와일더 ..<br/>
이렇게 대화할 수 있게 되는 것이다. <br/>
<br/>
이 프로세스는 양방향 이므로, 데이터를 보낼 때에도 Port 번호가 필요하다.<br/>
데이터를 받아 요청한 내용을 처리해서 응답을 다시 보내주려면 또 그 프로세스를 식별하기 위해 Port가 필요하기 때문이다.<br/>

프로세스를 식별할 때 Port를 사용한다는 것에 유념하면서 Server Socket의 처리과정을 한 번 알아보자.

## Server Socket 처리 흐름

1. Server Socket 생성 (socket)
  - 연결 대상에 대한 정보가 들어있지 않은 껍데기 Socket을 생성한다. 
2. Server Socket 바인딩 (bind)
  - Socket과 Port 번호를 바인딩한다.

3. Client 연결 요청 대기 (listen)
  - Server Socket에서 Port번호와 바인딩 작업을 마치고 나면 Client로부터의 연결 요청을 받아들일 준비가 되었다.
  - Client가 연결 요청을 할 때까지 계속 기다린다.
  - 이렇게 대기상태를 계속 지속하다가, 연결 요청이 오면 대기 상태를 종료하고 리턴한다.
  - 연결 요청 대기 상태일 때는 아직 연결 된게 아니다.

4. Client 연결 수립 (accept)
  - listen은 정말 기다리고 있다가 들리는 게 있으면 어 요청이 들린다! 하고 종료! 리턴! 하는게 끝이고, 실질적인 연결은 여기에서 된다.

     도데체 왜일까?

     accept 단계에서는 최종적으로 연결 요청을 받아들이고, Socket 간의 연결을 수립한다. 
     여기까지 들으면, 충분히 listen 단계에서도 할 수 있을거라 생각이 드는데, 중요한 이유가 있다. 
     accept 단계에서는 최종 요청을 받아들이면서, 새로운 Socket을 생성한다! 뚜둔! 

     당연히 Socket 간 연결이라고 했을 때, 당연히 Client - Server 간의 연결이겠찌?!! 했는데, 아니다. 

     Server Socket의 메인 역할은 Client의 연결 요청을 받는 것이었다! 그래서 계속 Client가 오기를 오매불망 기다렸던 것!

     연결 요청을 받고 accept를 통해 새로 생성된 Socket과 Client Socket을 매핑해주면 Server Socket의 역할은 끝이 난다. 
     (그렇기 때문에 Client Socket에 대한 내용을 Server Socket은 단순히 받아서 새로 생기는 Socket에게 넘겨주기만 한다.)

	  역할이 끝나면 Server Socket은 다시 다른 연결 요청을 처리하기 위해 대기(listen)하거나, Server Socket을 닫는다(close)
 

5. 데이터의 송수신 (Send, Recieve)

- 데이터 송수신에 대한 응답을 받으면 실행이 끝난다..

    - 송수신 간의 차이점.

        - 송신(Send)할 때에는 데이터를 보내는 것이기 때문에 데이터를 언제, 얼마나 보낼 것인지를 알 수 있다.

        - 수신(Recieve)할 때에는 상대방이 언제, 얼만큼의 데이터를 보낼 것인지 알 수가 없다.
        - 그렇기 때문에 수신하는 API는 별도의 Thread에서 진행하게 된다.

6. Socket 닫기 

  - 더 이상의 데이터 송수신이 필요없어지게되면, 소켓을 닫는다.
  - Server Socket은 자기 자신만 관리하는 게 아니라, Client와의 연결 수립에서 생성된 새로운 Socket에 대해서도 관리를 해주어야 한다는 거다.
---
이렇게 `Client Socket`, `Server Socket`의 역할을 통해 `Socket Programming`에 대해 알아보았다 

## Web Socket이란?
그럼 Web Socket은 뭘까?
